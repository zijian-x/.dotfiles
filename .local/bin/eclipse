#!/usr/bin/env bash

altty="$XDG_CONFIG_HOME/alacritty/colors.toml"
nvm="$XDG_CONFIG_HOME/nvim/lua/config/bg.lua"
rf="$XDG_CONFIG_HOME/rofi/colors.rasi"
ztr="$XDG_CONFIG_HOME/zathura/colorsrc"
feh="$XDG_CONFIG_HOME/feh/.mode"
dnst_dir="$XDG_CONFIG_HOME/dunst/dunstrc.d"

files=("$altty" "$feh" "$nvm" "$rf" "$ztr" "$dnst_dir")

mode=$(xrdb -query | grep mode | cut -f2)

toggle_xrdb()
{
    if [[ $mode == "dark" ]]; then
	xrdb -merge "$XDG_CONFIG_HOME/X11/themes/rose-pine-light"
    else
	xrdb -merge "$XDG_CONFIG_HOME/X11/themes/rose-pine-dark"
    fi
}

files()
{
    echo "${files[@]}"
}

toggle()
{
    [[ -z "$1" ]] && exit 1
    path="$1"

    if [[ $mode == "dark" ]]; then
	sed -i 's/dark/light/' "$path"
    else
	sed -i 's/light/dark/' "$path"
    fi
}

toggle_wp()
{
    if [[ $mode == "dark" ]]; then
	fehbg -l
    else
	fehbg -d
    fi
}

toggle_dunst()
{
    mv "$dnst_dir/00.conf" "$dnst_dir/02.conf" &&
	mv "$dnst_dir/01.conf" "$dnst_dir/00.conf" &&
	mv "$dnst_dir/02.conf" "$dnst_dir/01.conf" &&
	killall dunst && dunst &
}

main()
{
    # TODO parse with getopts
    if [[ -n "$1" ]]; then
	case "$1" in
	    -q|--query)
		echo "$mode"
		exit 0
		;;
	    -f|--files)
		files
		exit 0
		;;
	    *)
		exit 1
	esac
    fi

    toggle_wp && toggle_dunst &&
    toggle_xrdb && bspc wm -r &&
	toggle "$altty" &&
	toggle "$rf" &&
	toggle "$ztr" &&
	toggle "$nvm" && killall -s 10 nvim &> /dev/null
}

main "$@"
