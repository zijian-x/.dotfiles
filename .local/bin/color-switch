#!/usr/bin/env bash

acty="${XDG_CONFIG_HOME:-$HOME/.config}/alacritty/colors.yml"
nvm="${XDG_CONFIG_HOME:-$HOME/.config}/nvim/lua/config/bg.lua"
tmx="${XDG_CONFIG_HOME:-$HOME/.config}/tmux/colors.conf"
plb="${XDG_CONFIG_HOME:-$HOME/.config}/polybar/colors.ini"
rf="${XDG_CONFIG_HOME:-$HOME/.config}/rofi/colors.rasi"
ztr="${XDG_CONFIG_HOME:-$HOME/.config}/zathura/colorsrc"
feh="${XDG_CONFIG_HOME:-$HOME/.config}/feh/.mode"
dnst_dir="${XDG_CONFIG_HOME:-$HOME/.config}/dunst/dunstrc.d"

query()
{
    grep -oq "$@"
}

toggle()
{
    [[ -z "$1" ]] && exit 1
    path="$1"

    if query "dark" "$path";
    then
	sed -i 's/dark/light/' "$path"
    else
	sed -i 's/light/dark/' "$path"
    fi
}

switch_wp()
{
    if grep -oq "dark" "$feh" > /dev/null;
    then
	fehbg -l
    else
	fehbg -d
    fi
}

switch_dunst()
{
    mv "$dnst_dir/00.conf" "$dnst_dir/02.conf" &&
	mv "$dnst_dir/01.conf" "$dnst_dir/00.conf" &&
	mv "$dnst_dir/02.conf" "$dnst_dir/01.conf" &&
	killall dunst && dunst &
}

main()
{
    if [[ -n "$1" ]]; then
	case "$1" in
	    -q)
		query "dark" "$acty" && echo "dark" || echo "light"
		exit 0
		;;
	    *)
		exit 1
	esac
    fi

    switch_wp &&
	toggle "$plb" && "${XDG_CONFIG_HOME:-$HOME/.config}/polybar/launch.sh" > /dev/null 2>&1 &&
	toggle "$acty" &&
	toggle "$nvm" &&
	toggle "$tmx" &&
	toggle "$rf" &&
	toggle "$ztr" &&
	switch_dunst
}

main "$@"
