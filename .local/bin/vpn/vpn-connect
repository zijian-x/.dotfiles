#!/usr/bin/env bash

if systemctl status mullvad-daemon.service; then
    notify-send -u low "mullvad-daemon is running, proceeding to connect"
else
    expect <<- DONE
    set timeout -1
    spawn systemctl start mullvad-daemon.service
    expect "*?assword:*"
    send -- "$(pass user-zijian)"
    send -- "\r"
    expect eof
DONE

if systemctl status mullvad-daemon.service;
then
    notify-send -u low "mullvad-daemon started successfully"
else
    notify-send -u low "starting mullvad-daemon failed"
    exit 1
fi
fi

notify-send -u low "connecting" &&
    mullvad connect &&
    sleep 2 && vpn-status
