#!/usr/bin/env bash

interface=$(ip route | awk '/^default/ { print $5 ; exit }')
[[ -z "$interface" ]] && exit 1

if ! [[ -e "/sys/class/net/${interface}/operstate" ]] ||
    (! [[ "$TREAT_UNKNOWN_AS_UP" = "1" ]] &&
    ! [[ "$(cat /sys/class/net/${interface}/operstate)" = "up" ]])
then
    exit 1
fi

pac_upd="$(checkupdates 2> /dev/null)"
count=$(echo "$pac_upd" | wc -l)
if echo "$pac_upd" | grep -q "linux-.*arch" ; then
    total=" $count"
elif [[ "$count" -gt 9 ]]; then
    total="$count"
fi

aur_upd="$(auracle outdated 2> /dev/null | wc -l)"
if [[ "$aur_upd" -ne 0 ]]; then
    if [[ -n "$total" ]]; then
	total="$total "
    fi
    total="$total $aur_upd"
fi

printf "%s\n" "$total"
