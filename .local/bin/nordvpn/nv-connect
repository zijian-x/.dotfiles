#!/usr/bin/env bash

# server="$(curl --silent "https://api.nordvpn.com/v1/servers/recommendations?filters\[country_id\]=74&limit=1" | jq --raw-output '.[].hostname' | cut -d'.' -f1)"

if systemctl status nordvpnd; then
    notify-send -u low "nordvpnd already exists, proceeding to connect to ${1:-France}"
else
    expect <<- DONE
    set timeout -1
    spawn systemctl start nordvpnd
    expect "*?assword:*"
    send -- "$(pass user-zijian)"
    send -- "\r"
    expect eof
DONE

if systemctl status nordvpnd;
then
    notify-send -u low "nordvpnd started successfully"
else
    notify-send -u low "starting nordvpnd failed"
    exit 1
fi
fi

# nordvpn connect --group P2P "${1:-$server}" && exit 0

notify-send -u low "connecting to ${1:-France}..." &&
    sleep 1 && nordvpn connect France || notify-send -u low "failed to connect nv server"
