#!/usr/bin/env bash

undodir_entries()
{
    undodir="$HOME/.vim/undo"

    find "$undodir" -type f -ctime +30 -delete

    readarray -t files < <(ls "$undodir")
    for f in "${files[@]}"; do
	filename="$(echo "$f" | sed 's/%/\//g')"
	[[ ! -f "$filename" ]] && rm "$undodir/$f"
    done
}

log_files()
{
    rm $XDG_STATE_HOME/nvim/*log
}

vim_clean()
{
    undodir_entries
    log_files
}

printf "\n==> removing package cache\n\n" && sudo pacman -Sc --noconfirm
printf "\n==> cleaning undodir & removing log entries\n\n" && vim_clean
