#!/usr/bin/env bash

nvim_undo_clean()
{
    undodir="$XDG_STATE_HOME/nvim/undo"

    find "$undodir" -type f -ctime +30 -delete

    readarray -t files < <(ls "$undodir")
    for f in "${files[@]}"; do
	filename="$(echo "$f" | sed 's/%/\//g')"
	[[ ! -f "$filename" ]] && rm "$undodir/$f"
    done
}

printf "\n==> removing package cache\n\n" && sudo pacman -Sc --noconfirm
printf "\n==> cleaning undodir & removing log entries\n\n" && nvim_undo_clean
