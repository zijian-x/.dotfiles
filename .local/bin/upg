#!/usr/bin/env bash

noconfirm=""

pkg_upgrade()
{
    if [[ -n "$noconfirm" ]];
    then
	sudo pacman -Syu "$noconfirm" && aur-upg "$noconfirm"
    else
	sudo pacman -Syu && aur-upg
    fi

    [[ "$?" -eq 0 ]] && $HOME/.config/polybar/launch.sh > /dev/null 2>&1
}

vim_upgrade()
{
    cd "$HOME/aur" || exit 1

    auracle outdated nvim-packer-git > /dev/null 2>&1 &&
	aur-build "$noconfirm" nvim-packer-git
	    aur-build "$noconfirm" neovim-nightly-bin
	    nvim -c PackerSync
}

exit_invalid()
{
    echo "invalid option" && exit 1
}

main()
{
    for opt in "$@"; do
	[[ ! $opt == -* ]] && exit_invalid

	if [[ $opt == --* ]]; then
	    case $opt in
		--noconfirm)
		    noconfirm="--noconfirm"
		    ;;
		*)
		    exit_invalid
		    ;;
	    esac
	else
	    for ((i=1; i<${#opt}; ++i)); do
		case ${opt:i:1} in
		    h | -help)
			printf "options\n\t%s\n\t%s\n" \
			    "-p - upgrade packagaes" \
			    "-v - upgrade (n)vim"
			exit 0
			;;
		    a)
			pkg=1
			vim=1
			;;
		    p)
			pkg=1
			;;
		    v)
			vim=1
			;;
		    *)
			exit_invalid
			;;
		esac
	    done
	fi
    done

    if [[ -n $pkg ]] && [[ -n $vim ]]; then
	pkg_upgrade && vim_upgrade
    elif [[ -n $pkg ]] || [[ -z $pkg ]] && [[ -z $vim ]]; then
	pkg_upgrade
    elif [[ -n $vim ]]; then
	vim_upgrade
    fi
    exit 0
}

main "$@"
