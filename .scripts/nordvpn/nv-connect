#!/usr/bin/env bash

if pgrep -x nordvpnd; then
	notify-send -u low "nordvpnd already exists, proceeding to connect to ${1:-France}"
else
	expect <<- DONE
		set timeout -1
		spawn systemctl start nordvpnd
		expect "*?assword:*"
		send -- "$(pass user-zijian)"
		send -- "\r"
		expect eof
	DONE
	if systemctl status nordvpnd | grep -q '\bactive'; then
		notify-send -u low "nordvpnd started successfully"
	else
		notify-send -u low "starting nordvpnd failed" && exit 1
	fi
fi

nordvpn connect "${1:-France}" || notify-send -u low "connection failed"
